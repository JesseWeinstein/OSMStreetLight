<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Stra√üenlaternen in OpenStreetMap</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<link rel="stylesheet" href="style.css" />
		
		<!-- Load leaflet and jquery -->
		<script src="leaflet/leaflet.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/jquery-ui-1.10.0.custom.min.js"></script>
		<script src="js/geo.js" type="text/javascript"></script>
		<script src="leaflet/plugins/leaflet-hash/leaflet-hash.js"></script>
		<script src="js/gears_init.js" type="text/javascript"></script>
		
		<!-- Load i18next -->
		<script src="js/i18next/i18next.min.js"></script>
		<script src="js/i18next/i18nextXHRBackend.js"></script>
		<script src="js/i18next/i18nextBrowserLanguageDetector.min.js"></script>
		<script src="js/i18nextInit.js"></script>

		
		<script src="js/parse_scripts.js" type="text/javascript"></script>		
		
	</head>

	<body style="margin:0px">
		<div id="map" style="height: 100%"></div>
		<script>
		
			MarkerArray = new Array();
			var Layergroup = new L.LayerGroup();
			
			var map = new L.Map('map');
			var OSMUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
				OSMAttrib = 'Map data &copy; OpenStreetMap contributors, Data via <a href="http://www.overpass-api.de/">Overpass API</a>',
				OSM = new L.TileLayer(OSMUrl, {maxZoom: 19, attribution: OSMAttrib});
    		
    		loadingcounter = 0;

    		//Testen ob location abgefragt werden muss
    		if (document.URL.search(/#/)==-1){
	    		function success_callback(p)
				{
					//alert('lat='+p.coords.latitude.toFixed(2)+';lon='+p.coords.longitude.toFixed(2));
					mapInit( p.coords.latitude.toFixed(5) , p.coords.longitude.toFixed(5) );
				}
				
				function error_callback(p)
				{
					mapInit(-10000,-10000);
				}

	    		if(geo_position_js.init()){
					geo_position_js.getCurrentPosition(success_callback,error_callback,{enableHighAccuracy:true,options:5000});
				}
				else{
					mapInit(-10000,-10000);
				}		    		
	    	}

    		var ort = new L.LatLng(51, 11);
    		
	    	map.setView(ort, 6).addLayer(OSM);	
    		
    		//Permalink
			var hash = new L.Hash(map);
			map.on('moveend',function(){Moveaufruf();});
    		
    		function mapInit(lat,lon)
    		{
	    		
	    		if (lat > -10000)
	    		{
	    			var ort = new L.LatLng(lat, lon); // geographical point (longitude and latitude)
	    			var zoom = 14;
	    		}
	    		else
	    		{
	    			var ort = new L.LatLng(51, 11); // geographical point (longitude and latitude)
	    			var zoom = 6;
	    		}
				map.setView(ort, zoom).addLayer(OSM);

				map.on('moveend',function(){Moveaufruf();});
				Moveaufruf();
			}

			function openinJOSM(type, ID){
				$.ajax({
				  url: "http://127.0.0.1:8111/load_and_zoom?left="+lefttop.lng+"&right="+rightbottom.lng+"&top="+lefttop.lat+"&bottom="+rightbottom.lat+"&select="+type+ID
				});
			}
			
		</script>	
		<div id="zoomwarnung">
			<p id="zoomin"></p>
		</div>
		<div id="loading" style="display:none"><img src="./img/ajax-loader.gif"></div>

		<div id="options">
			<small><a target="_new" href="./about.html" id="aboutmap"></a> | <a href="https://flattr.com/submit/auto?fid=4zqqyl&url=http%3A%2F%2Fosmstreetlight.bplaced.net%2F" target="_new">Flattr</a></small>
		</div>
		<div id="lang">
			<select id="langselect">
				<option onclick="i18next.changeLanguage('en')" value="en">en </option>
				<option onclick="i18next.changeLanguage('de')" value="de">de </option>
			</select>
		</div>

	</body>
</html>
